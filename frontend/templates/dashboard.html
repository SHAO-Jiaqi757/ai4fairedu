{% extends "base.html" %}

{% block title %}Your Learning Dashboard - AI4FairEdu{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
{% endblock %}

{% block content %}
<section class="page-header">
    <h1>Your Learning Dashboard</h1>
    <p class="subtitle">Personalized insights and support strategies based on your profile</p>
</section>

<!-- Loading indicator -->
<div id="loading-overlay" class="loading-overlay" style="display: none;">
    <div class="loading-spinner"></div>
    <p>Analyzing your profile...</p>
    <a href="{{ url_for('refresh_analysis') }}" class="btn btn-primary mt-3">Refresh Analysis</a>
</div>

<section class="dashboard-section">
    <div class="dashboard-grid">
        <div class="dashboard-card profile-summary">
            <div class="card-header">
                <h2>Your Learning Profile</h2>
            </div>
            <div class="card-content">
                <div class="profile-type">
                    <h3>Learning Difficulty Type</h3>
                    <div class="difficulty-badge {% if analysis.difficulty_type == 'ADHD' %}adhd{% elif analysis.difficulty_type == 'Dyslexia' %}dyslexia{% elif analysis.difficulty_type == 'Combined' %}combined{% else %}unknown{% endif %}">
                        {{ analysis.difficulty_type|default('Analysis Pending') }}
                    </div>
                </div>
                
                <div class="severity-meter">
                    <h3>Severity Level</h3>
                    <div class="meter-container">
                        <div class="meter-bar">
                            <div class="meter-fill" style="width: {{ (analysis.severity_level|default(0) / 5) * 100 }}%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Mild</span>
                            <span>Moderate</span>
                            <span>Significant</span>
                        </div>
                    </div>
                </div>
                
                <div class="profile-details">
                    <div class="profile-features">
                        <h3>Specific Features</h3>
                        <ul class="feature-list">
                            {% if analysis.specific_features %}
                                {% for category, features in analysis.specific_features.items() %}
                                    <li class="feature-category">
                                        <span class="feature-name">{{ category|title }}</span>
                                    </li>
                                    {% for feature, value in features.items() %}
                                        <li class="feature-item">
                                            <span class="feature-name">- {{ feature|replace('_', ' ')|title }}</span>
                                            <span class="feature-value">{{ value }}</span>
                                        </li>
                                    {% endfor %}
                                {% endfor %}
                            {% else %}
                                <li>No specific features identified yet</li>
                            {% endif %}
                        </ul>
                    </div>
                    
                    <div class="profile-strengths">
                        <h3>Your Strengths</h3>
                        <ul class="strength-list">
                            {% if analysis.strengths %}
                                {% for strength, value in analysis.strengths.items() %}
                                    <li>
                                        <span class="strength-name">{{ strength|replace('_', ' ')|title }}</span>
                                        <span class="strength-value">{{ value }}</span>
                                    </li>
                                {% endfor %}
                            {% else %}
                                <li>No strengths identified yet</li>
                            {% endif %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="dashboard-card support-strategies">
            <div class="card-header">
                <h2>Recommended Support Strategies</h2>
            </div>
            <div class="card-content">
                <div class="strategy-section primary-strategies">
                    <h3>Primary Strategies</h3>
                    <ul class="strategy-list">
                        {% if strategies.primary %}
                            {% for strategy in strategies.primary %}
                                <li>{{ strategy }}</li>
                            {% endfor %}
                        {% else %}
                            <li>No primary strategies available yet</li>
                        {% endif %}
                    </ul>
                </div>
                
                <div class="strategy-section secondary-strategies">
                    <h3>Secondary Strategies</h3>
                    <ul class="strategy-list">
                        {% if strategies.secondary %}
                            {% for strategy in strategies.secondary %}
                                <li>{{ strategy }}</li>
                            {% endfor %}
                        {% else %}
                            <li>No secondary strategies available yet</li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="dashboard-section">
    <div class="dashboard-card actions">
        <div class="card-header">
            <h2>Next Steps</h2>
        </div>
        <div class="card-content">
            <div class="action-grid">
                <div class="action-item">
                    <div class="action-icon">
                        <i class="fas fa-upload"></i>
                    </div>
                    <div class="action-content">
                        <h3>Upload Learning Material</h3>
                        <p>Submit text-based learning materials to receive personalized adaptations based on your profile.</p>
                        <a href="{{ url_for('material_upload') }}" class="btn btn-primary">Upload Material</a>
                    </div>
                </div>
                
                <div class="action-item">
                    <div class="action-icon">
                        <i class="fas fa-history"></i>
                    </div>
                    <div class="action-content">
                        <h3>View Previous Materials</h3>
                        <p>Access your previously processed learning materials and continue your studies.</p>
                        <a href="{{ url_for('materials_history') }}" class="btn btn-secondary">View History</a>
                    </div>
                </div>
                
                <div class="action-item">
                    <div class="action-icon">
                        <i class="fas fa-user-edit"></i>
                    </div>
                    <div class="action-content">
                        <h3>Update Your Profile</h3>
                        <p>Retake the questionnaire to update your learning profile as your needs change.</p>
                        <a href="{{ url_for('questionnaire') }}" class="btn btn-secondary">Update Profile</a>
                    </div>
                </div>
                
                <div class="action-item">
                    <div class="action-icon">
                        <i class="fas fa-graduation-cap"></i>
                    </div>
                    <div class="action-content">
                        <h3>Learning Resources</h3>
                        <p>Explore additional resources and tips for managing your specific learning challenges.</p>
                        <a href="#" class="btn btn-secondary">View Resources</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<section class="dashboard-section">
    <div class="dashboard-card progress-tracking">
        <div class="card-header">
            <h2>Your Learning Progress</h2>
        </div>
        <div class="card-content">
            <div class="progress-placeholder">
                <p>Your learning progress will be displayed here as you use the system.</p>
                <p>Upload and study materials to start tracking your progress.</p>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Check if analysis is pending
        const difficultyType = "{{ analysis.difficulty_type|default('Analysis Pending') }}";
        const loadingOverlay = document.getElementById('loading-overlay');
        
        // If analysis is pending, show loading overlay and check for analysis results
        if (difficultyType === 'Analysis Pending') {
            loadingOverlay.style.display = 'flex';
            
            // Function to check if analysis is complete
            function checkAnalysis() {
                fetch('/check-analysis')
                    .then(response => response.json())
                    .then(data => {
                        if (data.complete) {
                            // Reload the page to show the analysis results
                            window.location.reload();
                        } else {
                            // Check again after a delay
                            setTimeout(checkAnalysis, 2000);
                        }
                    })
                    .catch(error => {
                        console.error('Error checking analysis:', error);
                        // Try again after a delay
                        setTimeout(checkAnalysis, 5000);
                    });
            }
            
            // Start checking for analysis results
            checkAnalysis();
        }
        
        // Animation for dashboard cards
        const cards = document.querySelectorAll('.dashboard-card');
        
        function animateCards() {
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.classList.add('visible');
                }, index * 150);
            });
        }
        
        // Start animation after a short delay
        setTimeout(animateCards, 300);
    });
</script>
{% endblock %} 